#pragma once
#include "Module.h"
#include "p2List.h"
#include "p2Point.h"
#include "Globals.h"

class PhysBody;
class b2RevoluteJoint;

class ModuleSceneIntro : public Module
{
public:
	ModuleSceneIntro(Application* app, bool start_enabled = true);
	~ModuleSceneIntro();

	bool Start();
	update_status Update();
	bool CleanUp();
	void OnCollision(PhysBody* bodyA, PhysBody* bodyB);
	void LoadMap();

public:

	uint score;

	PhysBody* ball;
	b2RevoluteJoint* left_joint;
	b2RevoluteJoint* right_joint;

	p2List<PhysBody*> bumpers;
	p2List<PhysBody*> flippers;
	p2List<PhysBody*> joint_anchors;
	p2List<PhysBody*> chains;

	PhysBody* left_bouncer;
	PhysBody* right_bouncer;

	PhysBody* sensor;
	bool sensed;

	SDL_Texture* circle;
	SDL_Texture* ball_tex;
	SDL_Texture* background;
	uint flipper_fx;
	uint triangle_fx;
	uint bumper_fx;

	p2Point<int> ray;
	bool ray_on;



	int left_flipper[16] = {
		10, 19,
		73, 48,
		83, 48,
		84, 42,
		79, 36,
		17, 1,
		5, 2,
		1, 11
	};

	int right_flipper[16] = {
		-10, 19,
		-73, 48,
		-83, 48,
		-84, 42,
		-79, 36,
		-17, 1,
		-5, 2,
		-1, 11
	};

	int bouncer_block_right[14] = {
		320, 693,
		355, 620,
		365, 615,
		370, 618,
		373, 623,
		374, 681,
		325, 702
	};


	// Pivot 0, 0
	int bouncer_block_left[28] = {
		110, 680,
		120, 682,
		125, 694,
		124, 701,
		110, 697,
		84, 682,
		79, 679,
		76, 671,
		75, 627,
		79, 621,
		86, 618,
		92, 622,
		98, 632,
		93, 638
	};

	int bouncer_left[8] = {
		5, -6,
		0, 0,
		17, 22,
		27, 42,
	};




	int bottom_left[46] = {
		39, 631,
		45, 630,
		48, 634,
		48, 647,
		48, 660,
		48, 673,
		48, 685,
		55, 694,
		63, 698,
		78, 706,
		96, 718,
		111, 729,
		122, 734,
		120, 740,
		118, 744,
		107, 737,
		86, 724,
		69, 714,
		54, 704,
		45, 698,
		39, 685,
		38, 664,
		38, 643
	};


	int bottom_right[38] = {
		338, 731,
		390, 698,
		396, 694,
		401, 688,
		401, 680,
		401, 657,
		402, 639,
		405, 635,
		410, 637,
		411, 658,
		411, 681,
		410, 688,
		408, 695,
		402, 703,
		394, 707,
		358, 730,
		338, 741,
		329, 747,
		324, 740
	};


	int pinball[338] = {
		0, 798,
		153, 798,
		31, 732,
		17, 721,
		10, 701,
		12, 627,
		13, 615,
		28, 603,
		47, 591,
		47, 547,
		53, 538,
		63, 537,
		71, 541,
		73, 547,
		76, 566,
		85, 567,
		96, 558,
		97, 543,
		86, 542,
		56, 496,
		61, 485,
		11, 400,
		37, 383,
		50, 405,
		80, 390,
		93, 408,
		125, 390,
		100, 343,
		121, 330,
		148, 372,
		162, 373,
		175, 365,
		151, 343,
		136, 312,
		125, 276,
		127, 243,
		136, 220,
		146, 200,
		128, 181,
		146, 158,
		170, 141,
		197, 130,
		222, 123,
		227, 148,
		260, 151,
		291, 160,
		313, 172,
		328, 186,
		343, 208,
		355, 233,
		360, 252,
		366, 257,
		373, 247,
		366, 220,
		351, 188,
		332, 166,
		306, 145,
		278, 136,
		243, 131,
		248, 103,
		287, 107,
		318, 121,
		343, 140,
		370, 165,
		392, 202,
		401, 232,
		403, 258,
		400, 288,
		406, 298,
		410, 291,
		413, 263,
		412, 237,
		402, 207,
		386, 170,
		357, 137,
		333, 118,
		300, 101,
		263, 92,
		223, 91,
		187, 102,
		153, 116,
		141, 93,
		181, 76,
		217, 67,
		255, 67,
		301, 75,
		338, 91,
		368, 112,
		392, 137,
		415, 167,
		430, 206,
		438, 236,
		440, 267,
		436, 295,
		430, 323,
		436, 332,
		440, 322,
		448, 280,
		448, 245,
		442, 215,
		425, 170,
		406, 138,
		387, 116,
		352, 86,
		318, 67,
		277, 57,
		235, 53,
		191, 60,
		152, 71,
		126, 87,
		112, 112,
		102, 146,
		102, 203,
		101, 303,
		31, 345,
		15, 347,
		5, 336,
		5, 140,
		10, 121,
		21, 115,
		61, 91,
		107, 67,
		155, 43,
		215, 28,
		263, 28,
		310, 36,
		367, 62,
		406, 95,
		435, 133,
		463, 185,
		471, 233,
		470, 303,
		463, 333,
		448, 363,
		470, 403,
		471, 465,
		472, 548,
		472, 632,
		472, 727,
		447, 725,
		448, 631,
		448, 526,
		448, 432,
		445, 413,
		435, 401,
		383, 487,
		393, 498,
		381, 517,
		363, 543,
		350, 543,
		348, 553,
		356, 562,
		371, 568,
		375, 561,
		373, 543,
		385, 540,
		395, 540,
		402, 552,
		402, 592,
		426, 606,
		433, 617,
		437, 625,
		437, 696,
		433, 708,
		423, 722,
		295, 800,
		478, 800,
		480, -1,
		1, -1
	};

};